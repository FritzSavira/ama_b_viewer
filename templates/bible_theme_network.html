<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beziehung zwischen Bibelreferenzen und Hauptthemen</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            padding-top: 20px;
        }
        #network-container {
            width: 100%;
            height: 80vh;
            border: 1px solid #ccc;
            margin-top: 20px;
        }
        .node {
            stroke: #fff;
            stroke-width: 1.5px;
        }
        .link {
            stroke: #999;
            stroke-opacity: 0.6;
        }
        .node-label {
            font-size: 10px;
            fill: #333;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Beziehung zwischen Bibelreferenzen und Hauptthemen</h1>

        <div id="network-container"></div>

        <a href="/" class="btn btn-primary mt-4">Zur√ºck zur Startseite</a>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('network-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            const svg = d3.select("#network-container").append("svg")
                .attr("width", width)
                .attr("height", height);

            const color = d3.scaleOrdinal(d3.schemeCategory10);

            const simulation = d3.forceSimulation()
                .force("link", d3.forceLink().id(d => d.id).distance(100))
                .force("charge", d3.forceManyBody().strength(-300))
                .force("center", d3.forceCenter(width / 2, height / 2));

            fetch('/api/bible_theme_network')
                .then(response => response.json())
                .then(graph => {
                    const links = graph.links.map(d => Object.create(d));
                    const nodes = graph.nodes.map(d => Object.create(d));

                    simulation
                        .nodes(nodes)
                        .on("tick", ticked);

                    simulation.force("link")
                        .links(links);

                    const link = svg.append("g")
                        .attr("stroke", "#999")
                        .attr("stroke-opacity", 0.6)
                        .selectAll("line")
                        .data(links)
                        .join("line")
                        .attr("stroke-width", d => Math.sqrt(d.value));

                    const node = svg.append("g")
                        .attr("stroke", "#fff")
                        .attr("stroke-width", 1.5)
                        .selectAll("circle")
                        .data(nodes)
                        .join("circle")
                        .attr("r", 8)
                        .attr("fill", d => color(d.type))
                        .call(drag(simulation));

                    node.append("title")
                        .text(d => d.id);

                    const labels = svg.append("g")
                        .attr("class", "labels")
                        .selectAll("text")
                        .data(nodes)
                        .enter()
                        .append("text")
                        .attr("class", "node-label")
                        .attr("dx", 12)
                        .attr("dy", ".35em")
                        .text(d => d.id);

                    function ticked() {
                        link
                            .attr("x1", d => d.source.x)
                            .attr("y1", d => d.source.y)
                            .attr("x2", d => d.target.x)
                            .attr("y2", d => d.target.y);

                        node
                            .attr("cx", d => d.x)
                            .attr("cy", d => d.y);

                        labels
                            .attr("x", d => d.x)
                            .attr("y", d => d.y);
                    }

                    function drag(simulation) {
                        function dragstarted(event, d) {
                            if (!event.active) simulation.alphaTarget(0.3).restart();
                            d.fx = d.x;
                            d.fy = d.y;
                        }

                        function dragged(event, d) {
                            d.fx = event.x;
                            d.fy = event.y;
                        }

                        function dragended(event, d) {
                            if (!event.active) simulation.alphaTarget(0);
                            d.fx = null;
                            d.fy = null;
                        }

                        return d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended);
                    }
                })
                .catch(error => console.error('Error fetching network data:', error));
        });
    </script>
</body>
</html>